@using CinemaApp.Application.CinemaApp;
@model IEnumerable<CinemaApp.Application.CinemaApp.MovieDto>

@{
    ViewData["Title"] = "Index";
}

<div class="wrapper">
    <aside id="sidebar">
        <div class="h-100">
            <ul class="sidebar-nav">
                <li class="sidebar-item">
                    <form action="" class="form">
                        <div class="input-group">
                            <input type="text" class="form-control form-input" placeholder="Search anything...">
                            <button class="search-btn" type="submit"><i class="bi bi-search"></i></button>
                        </div>
                    </form>
                </li>
                <li class="sidebar-header">
                    Halls
                </li>
                @foreach (var hall in ViewBag.Halls)
                {
                    <li class="sidebar-item">
                        <input type="checkbox" class="hall-checkbox" value="@hall.Number">
                        <label>Hall @hall.Number</label>
                    </li>
                }
            </ul>
        </div>
    </aside>
    <div class="main">
        <nav class="navbar navbar-expand px-3">
            <button class="btn text-light border" type="button">
                <span class="bi bi-funnel"></span>
            </button>
        </nav>
        <main class="px-3">
            <div class="list">
                <div class="slider-wrapper">
                    <button id="prev-slide" class="slide-button material-symbols-rounded">
                        <i class="bi bi-caret-left-fill"></i>
                    </button>
                    <ul class="image-list">
                        @foreach (var date in ViewBag.Calendar)
                        {
                            <li>
                                <div class="calendar-box">
                                    <a class="calendar-date text-decoration-none" data-date="@date.ToString("yyyy-MM-dd HH:mm:ss")">
                                        <div class="date-container">
                                            <p class="day">@date.Day</p>
                                            <p class="month">@date.ToString("MMM", new System.Globalization.CultureInfo("en-US"))</p>
                                        </div>
                                    </a>
                                </div>
                            </li>
                        }
                    </ul>
                    <button id="next-slide" class="slide-button material-symbols-rounded">
                        <i class="bi bi-caret-right-fill"></i>
                    </button>
                </div>
                <div class="slider-scrollbar">
                    <div class="scrollbar-track">
                        <div class="scrollbar-thumb"></div>
                    </div>
                </div>
            </div>
            <div class="ps-5 pt-5" id="shows-list-partial">
                <partial name="_ShowsListPartial" model="@Model" />
            </div>
        </main>
    </div>
</div>

<style>
    .calendar-box {
        width: 80px;
        height: 110px;
        border: 1px solid transparent;
        border-radius: 10px;
        background-color: #ffffff;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: #000000;
        text-decoration: none;
        cursor: pointer;
    }

    .selected {
        width: 80px;
        height: 110px;
        border: 3px solid #000000;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
</style>

@section Scripts {
    <script src="~/js/cinemaapp/mainpage/mainpagescripts.js"></script>
    <link href="~/css/repertoire/repertoirestylesheet.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {
            var defaultDate = $('.calendar-date').first().data('date');
            selectDate(defaultDate);
        });

        // Sidebar
        const toggler = document.querySelector(".btn");
        toggler.addEventListener("click", function () {
            document.querySelector("#sidebar").classList.toggle("collapsed");
        });

        var selectedDate = null;

        $('.calendar-date').click(function () {
            var date = $(this).data('date');
            selectDate(date);
            updateMovieList();
        });

        function selectDate(date) {
            $('.calendar-date').removeClass('selected');

            $('[data-date="' + date + '"]').addClass('selected');

            selectedDate = date;
            console.log("selectedDate: " + selectedDate);
        }

        // Function to update the movie list based on filters and sorting
        function updateMovieList() {
            var selectedHalls = $('.hall-checkbox:checked').map(function () {
                return $(this).val();
            }).get().join(',');

            console.log("selectedHalls: " + selectedHalls);

            $.ajax({
                url: '/Movie/SortShowsList',
                data: {
                    hallNumber: selectedHalls,
                    repertoireDate: selectedDate
                },
                success: function (data) {
                    $('#shows-list-partial').html(data);
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        }

        $('.hall-checkbox').change(updateMovieList);
    </script>
}

@*<h1 class="text-light">Index</h1>

    <div class="container">
    <p>
    @if (isAdmin)
    {
    <a asp-action="Create" class="btn btn-primary">Create New Movie</a>
    <a asp-action="CreateShow" class="btn btn-primary">Create New Show</a>
    }
    </p>
    <div class="row">
    <div class="col">
    @foreach (var movie in @Model)
    {
    <div class="border rounded p-5 mb-3 d-flex justify-content-between align-items-center">
    <div>
    <p class="text-light">@movie.Title</p>
    <p class="text-light"><strong>Gatunek:</strong> @movie.Genre</p>
    <p class="text-light"><strong>Kraj:</strong> @movie.Country</p>
    <p class="text-light">
    <strong>Wiek:</strong>
    @{
    var ageRatingId = movie.AgeRatingId;
    var ageRatings = ViewBag.AgeRatings as List<AgeRatingDto>;
    var ageRating = ageRatings.FirstOrDefault(ar => ar.Id == ageRatingId);
    var ageRatingName = ageRating != null ? ageRating.MinimumAge : "Brak danych";
    @ageRatingName
    }
    </p>
    <p class="text-light"><strong>Język:</strong> @movie.Language</p>
    <p class="text-light"><strong>Data premiery:</strong> @movie.ReleaseDate.ToShortDateString()</p>
    <p class="text-light"><strong>Godzina rozpoczęcia:</strong> @movie.StartTime.ToString("dd.MM.yyyy HH:mm")</p>
    <p class="text-light"><strong>Numer sali:</strong> @movie.HallNumber</p>
    </div>
    <div>
    <a asp-controller="Movie" asp-action="Details" asp-route-encodedTitle="@movie.EncodedTitle" class="text-light">Details</a>
    @if (isAdmin)
    {
    <a asp-controller="Movie" asp-action="Edit" asp-route-encodedTitle="@movie.EncodedTitle" class="text-light">Edit</a>
    }
    </div>
    </div>
    }
    </div>
    </div>
    </div>*@
